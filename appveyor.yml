version: 1.0.{build}

pull_requests:
  do_not_increment_build_number: true

skip_tags: true

image:
- ubuntu
- Visual Studio 2017

configuration:
- release
- debug

environment:
  matrix:
  - V8_TARGET_ARCH: x64
  - v8_TARGET_ARCH: ia32

init:
- cmd: echo %V8_TARGET_ARCH% %CONFIGURATION%
- cmd: set BUILD_OS=win32
- sh: echo ${V8_TARGET_ARCH} ${CONFIGURATION}
- sh: export BUILD_OS=linux

before_build:
- cmd: python -m pip install -U pip
- cmd: python -m pip install pywin32
- cmd: C:\Python35-x64\python.exe build.py sync
- sh: python3.5 build.py sync

build_script:
- cmd: C:\Python35-x64\python.exe build.py build windows %V8_TARGET_ARCH% %CONFIGURATION%
- sh: python3.5 build.py build nix ${V8_TARGET_ARCH} ${CONFIGURATION}

deploy_script:
- cmd: dir build\win32\%V8_TARGET_ARCH%\%CONFIGURATION%
- cmd: dir build\win32\%V8_TARGET_ARCH%\%CONFIGURATION%\obj
#- cmd: C:\Python35-x64\python.exe build.py deploy-windows %V8_TARGET_ARCH% %Configuration%

artifacts:
- path: build\%BUILD_OS%\%V8_TARGET_ARCH%\%CONFIGURATION%\obj\v8_monolith.lib
  name: build-$(V8_TARGET_ARCH)_$(CONFIGURATION)
  type: zip

